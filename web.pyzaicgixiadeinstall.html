<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

<meta name="author" content="lmatt wang" />
<meta name="description" content="由于ixwebhosting下无法安装web.py之类的程序，只能将web.py当作工程的一部分。这需要将web.py下的web目录拷贝到工程目录中，以后只需要import web就可以使用web.py了。 web.py可以和Lighttpd,Apache搭配使用。web.py的官网推荐的是使用lighttpd（fastcgi）。这里介绍的是Apache下的CGI方式（这种方式效率不高，不过在ixwebhosting下只能使用这种方式）。 在.htaccess下添加如下代码： [codesyntax lang="apache"] Options +ExecCGI AddHandler cgi-script .py [/codesyntax] 或者在http.conf（或apache2.conf）下添加如下代码： [codesyntax lang="apache"] Alias /foo/static/ /path/to/static ScriptAlias /foo/ /path/to/code.py [/codesyntax ..." />
<meta name="keywords" content="">
<meta property="og:site_name" content="do not know"/>
<meta property="og:title" content="web.py在cgi下的install"/>
<meta property="og:description" content="由于ixwebhosting下无法安装web.py之类的程序，只能将web.py当作工程的一部分。这需要将web.py下的web目录拷贝到工程目录中，以后只需要import web就可以使用web.py了。 web.py可以和Lighttpd,Apache搭配使用。web.py的官网推荐的是使用lighttpd（fastcgi）。这里介绍的是Apache下的CGI方式（这种方式效率不高，不过在ixwebhosting下只能使用这种方式）。 在.htaccess下添加如下代码： [codesyntax lang="apache"] Options +ExecCGI AddHandler cgi-script .py [/codesyntax] 或者在http.conf（或apache2.conf）下添加如下代码： [codesyntax lang="apache"] Alias /foo/static/ /path/to/static ScriptAlias /foo/ /path/to/code.py [/codesyntax ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://lmatt-bit.github.io/blog/web.pyzaicgixiadeinstall.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2010-04-19 16:58:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://lmatt-bit.github.io/blog/author/lmatt-wang.html">
<meta property="article:section" content="misc"/>
<meta property="og:image" content="">
  <title>do not know &ndash; web.py在cgi下的install</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://lmatt-bit.github.io/blog">
        <img src="http://lmatt-bit.github.io/blog/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="http://lmatt-bit.github.io/blog"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="http://lmatt-bit.github.io/blog/pages/guanyuwo(About-Me).html#guanyuwo(About-Me)">关于我(About Me)</a></li>
          <li><a href="http://getpelican.com/" target="_blank">Pelican</a></li>
          <li><a href="http://python.org/" target="_blank">Python.org</a></li>
          <li><a href="http://jinja.pocoo.org/" target="_blank">Jinja2</a></li>
        </ul>
      </nav>
      <ul class="social">
        <li><a class="sc-social link" href="#" target="_blank"><i class="fa fa-social link"></i></a></li>
        <li><a class="sc-Another social link" href="#" target="_blank"><i class="fa fa-Another social link"></i></a></li>
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="web.pyzaicgixiadeinstall">web.py在cgi下的install</h1>
    <p>Posted on Mon 19 April 2010 in <a href="http://lmatt-bit.github.io/blog/category/misc.html">misc</a></p>
  </header>
  <div>
    <p>由于ixwebhosting下无法安装web.py之类的程序，只能将web.py当作工程的一部分。这需要将web.py下的web目录拷贝到工程目录中，以后只需要import
web就可以使用web.py了。</p>
<p>web.py可以和Lighttpd,Apache搭配使用。web.py的官网推荐的是使用lighttpd（fastcgi）。这里介绍的是Apache下的CGI方式（这种方式效率不高，不过在ixwebhosting下只能使用这种方式）。</p>
<p>在.htaccess下添加如下代码：</p>
<p>[codesyntax lang="apache"]</p>
<div class="highlight"><pre><span></span>Options +ExecCGI
AddHandler cgi-script .py
</pre></div>


<p>[/codesyntax]</p>
<p>或者在http.conf（或apache2.conf）下添加如下代码：</p>
<p>[codesyntax lang="apache"]</p>
<div class="highlight"><pre><span></span>Alias /foo/static/ /path/to/static
ScriptAlias /foo/ /path/to/code.py
</pre></div>


<p>[/codesyntax]</p>
<p>上述内容参见于<a href="http://webpy.org/">web.py</a>的官网。</p>
<p>除了作以上配置外，web.py在CGI下运行还需要安装<a href="http://trac.saddi.com/flup">flup</a>。同web.py一样，<a href="http://trac.saddi.com/flup">flup</a>也存在无法安装的问题。这里同样将flup文件下载解压到工程目录，<span
style="text-decoration: line-through;">不过需要注意的是需要修改其中的部分代码。由于flup不是安装到机器上，其代码中的部分导入失败，这需要将"import
flup.*"之类的语句去除掉flup。(如果将flup放在web.py的目录下才需要)</span>\</p>
<blockquote>
<p>下面引用<a href="http://webpy.org/">web.py</a>官网内容：
</p></p>
</blockquote>
<h2>产品</h2>
<p>现在所运行 web.py 程序的web服务器是挺不错的，
但绝大多数网站还是需要更加专业一些的web服务器。web.py 实现了
<a href="http://www.python.org/dev/peps/pep-0333/">WSGI</a>
并能在任何兼容它的服务器上运行。 WSGI
是一个web服务器与应用程序之间的通用API, 就如Java 的 Servlet 接口。
你需要安装 <a href="http://trac.saddi.com/flup">flup</a> (<a href="http://www.saddi.com/software/flup/dist/">download
here</a>) 使web.py 支持with CGI，
FastCGI 或 SCGI， flup提供了这些API的WSGI接口。</p>
<p>对于所有的CGI变量， 添加以下到你的 <code>code.py</code>:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
</pre></div>
</td></tr></table>

<p>并运行 <code>chmod +x code.py</code> 添加可执行属性。</p>
<p><a name="lighttpd"></a>\</p>
<h3>LightTPD</h3>
<p><a name="lighttpdfastcgi"></a>\</p>
<h4>.. 使用 FastCGI</h4>
<p>在产品中通过FastCGI结合lighttpd是web.py使用的一种推荐方法。
<a href="http://reddit.com/">reddit.com</a> 通过该方法来处理百万次的点击。</p>
<p>lighttpd config设置参考如下：</p>
<div class="highlight"><pre><span></span> server.modules = (&quot;mod_fastcgi&quot;, &quot;mod_rewrite&quot;)
 server.document-root = &quot;/path/to/root/&quot;
 fastcgi.server = ( &quot;/code.py&quot; =&gt;
 (( &quot;socket&quot; =&gt; &quot;/tmp/fastcgi.socket&quot;,
    &quot;bin-path&quot; =&gt; &quot;/path/to/root/code.py&quot;,
    &quot;max-procs&quot; =&gt; 1
 ))
 )

 url.rewrite-once = (
   &quot;^/favicon.ico$&quot; =&gt; &quot;/static/favicon.ico&quot;,
   &quot;^/static/(.*)$&quot; =&gt; &quot;/static/$1&quot;,
   &quot;^/(.*)$&quot; =&gt; &quot;/code.py/$1&quot;
 )
</pre></div>


<p>在某些版本的lighttpd中，
需要保证fastcgi.server选项下的"check-local"属性设置为"false",
特别是当你的 <code>code.py</code> 不在文档根目录下。</p>
<p>如果你得到错误显示不能够导入flup， 请在命令行下输入 "easy_install flup"
来安装。</p>
<p>从修订版本 145开始，
如果你的代码使用了重定向，还需要在fastcgi选项下设置bin-environment变量。
如果你的代码重定向到<a href="http://domain.com/">http://domain.com/</a> 而在url栏中你会看到
<a href="http://domain.com/code.py/%EF%BC%8C">http://domain.com/code.py/，</a>
你可以通过设置这个环境变量来阻止。 这样你的fastcgi.server设置将会如下：</p>
<div class="highlight"><pre><span></span>fastcgi.server = ( &quot;/code.py&quot; =&gt;
((
   &quot;socket&quot; =&gt; &quot;/tmp/fastcgi.socket&quot;,
   &quot;bin-path&quot; =&gt; &quot;/path/to/root/code.py&quot;,
   &quot;max-procs&quot; =&gt; 1,
   &quot;bin-environment&quot; =&gt; (
     &quot;REAL_SCRIPT_NAME&quot; =&gt; &quot;&quot;
   ),
   &quot;check-local&quot; =&gt; &quot;disable&quot;
))
)
</pre></div>


<p><a name="apache"></a>\</p>
<h3>Apache</h3>
<p><a name="apachecgi"></a>\</p>
<h4>.. 使用 CGI</h4>
<p>添加以下到 <code>httpd.conf</code> 或 <code>apache2.conf</code>。</p>
<div class="highlight"><pre><span></span>Alias /foo/static/ /path/to/static
ScriptAlias /foo/ /path/to/code.py
</pre></div>


<p><a name="apachecgihtaccess"></a>\</p>
<h4>.. 使用 CGI .htaccess</h4>
<p>CGI很容易配置， 但不适合高性能网站。 添加以下到你的 <code>.htaccess</code>：</p>
<div class="highlight"><pre><span></span>Options +ExecCGI
AddHandler cgi-script .py
</pre></div>


<p>将你的浏览器指向 <code>http://example.com/code.py/</code>。
不要忘记最后的斜杠，否则你将会看到 <code>not found</code> 消息 (因为在 <code>urls</code>
列表中你输入的没有被匹配到). 为了让其运行的时候不需要添加 <code>code.py</code>，
启用mod_rewrite 法则 (查看如下)。</p>
<p>注意: <code>web.py</code> 的实现破坏了 <code>cgitb</code> 模块，因为它截取了 <code>stdout</code>。
可以通过以下的方法来解决该问题：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">cgitb</span><span class="p">;</span> <span class="n">cgitb</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="c1"># ... import web etc here...</span>

<span class="k">def</span> <span class="nf">cgidebugerror</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    &quot;&quot;&quot;</span>        <span class="n">_wrappedstdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">web</span><span class="o">.</span><span class="n">_oldstdout</span>
    <span class="n">cgitb</span><span class="o">.</span><span class="n">handler</span><span class="p">()</span>

    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">_wrappedstdout</span>

<span class="n">web</span><span class="o">.</span><span class="n">internalerror</span> <span class="o">=</span> <span class="n">cgidebugerror</span>
</pre></div>


<p><a name="apachefastcgi"></a>\</p>
<h4>.. 使用 FastCGI</h4>
<p>FastCGI很容易配置，运行方式如同mod_python。</p>
<p>添加以下到 <code>.htaccess</code>：</p>
<div class="highlight"><pre><span></span>      SetHandler fastcgi-script
</pre></div>


<p>不幸的是, 不像lighttpd, Apache不能够暗示你的web.py脚本以FastCGI
服务器的形式工作，因此你需要明确的告诉web.py。 添加以下到 <code>code.py</code>的
<code>if __name__ == "__main__":</code> 行前：</p>
<div class="highlight"><pre><span></span>web.wsgi.runwsgi = lambda func, addr=None: web.wsgi.runfcgi(func, addr)
</pre></div>


<p>将你的浏览器指向 <code>http://example.com/code.py/</code>。
不要忘记最后的斜杠，否则你将会看到 <code>not found</code> 消息 (因为在 <code>urls</code>
列表中你输入的没有被匹配到). 为了让其运行的时候不需要添加 <code>code.py</code>，
启用mod_rewrite 法则 (查看如下)。</p>
<p><a href="http://lemurware.blogspot.com/2006/05/webpy-apache-configuration-and-you.html">Walter
还有一些额外建议</a>.</p>
<p><a name="apachescgi"></a>\</p>
<h4>.. 使用 SCGI</h4>
<p><a href="https://www.mems-exchange.org/software/scgi/">https://www.mems-exchange.org/software/scgi/</a> 从
<a href="http://www.mems-exchange.org/software/files/mod_scgi/">http://www.mems-exchange.org/software/files/mod_scgi/</a> 下载 <code>mod_scgi</code>
代码 windows apache 用户： 编辑 httpd.conf：</p>
<div class="highlight"><pre><span></span>LoadModule scgi_module Modules/mod_scgi.so
SCGIMount / 127.0.0.1:8080
</pre></div>


<p>重启apache，并在命令行中如下方式启动code.py：</p>
<div class="highlight"><pre><span></span>python code.py 127.0.0.1:8080 scgi
</pre></div>


<p>打开你的浏览器，访问127.0.0.1 It's ok!</p>
<p><a name="apachemodpython"></a>\</p>
<h4>.. 使用 mod_python</h4>
<p>mod_python 运行方式如同FastCGI， 但不是那么方便配置。</p>
<p>对于 Python 2.5 按照如下：</p>
<div class="highlight"><pre><span></span>cd /usr/lib/python2.5/wsgiref
# or in windows: cd /python2.5/lib/wsgiref
wget -O modpython_gateway.py http://projects.amor.org/misc/browser/modpython_gateway.py?format=raw
# or fetch the file from that address using your browser
</pre></div>


<p>对于 Python \&lt;2.5 按照如下：</p>
<div class="highlight"><pre><span></span>cd /usr/lib/python2.4/site-packages
# or in windows: cd /python2.4/lib/site-packages
svn co svn://svn.eby-sarna.com/svnroot/wsgiref/wsgiref
cd wsgiref
wget -O modpython_gateway.py http://projects.amor.org/misc/browser/modpython_gateway.py?format=raw
# or fetch the file from that address using your browser
</pre></div>


<p>重命名 <code>code.py</code> 为 <code>codep.py</code> 或别的名字， 添加：</p>
<div class="highlight"><pre><span></span>main = web.wsgifunc(web.webpyfunc(urls, globals()))
</pre></div>


<p>在 <code>.htaccess</code> 中， 添加：</p>
<div class="highlight"><pre><span></span>AddHandler python-program .py
PythonHandler wsgiref.modpython_gateway::handler
PythonOption wsgi.application codep::main
</pre></div>


<p>你应该希望添加 <code>RewriteRule</code> 将 <code>/</code> 指向 <code>/codep.py/</code></p>
<p>确保访问 <code>/codep.py/</code> 的时候有添加最后的 <code>/</code>。
否则，你将会看到一条错误信息，比如
<code>A server error occurred. Please contact the administrator.</code></p>
<p><a name="apachemodwsgi"></a>\</p>
<h4>.. 使用 mod_wsgi</h4>
<p>mod_wsgi 是一个新的Apache模块
<a href="http://code.google.com/p/modwsgi/wiki/PerformanceEstimates">通常优于mod_python</a>
用于架设WSGI应用，它非常容易配置。</p>
<p>在 <code>code.py</code> 的最后添加：</p>
<div class="highlight"><pre><span></span>application = web.wsgifunc(web.webpyfunc(urls, globals()))
</pre></div>


<p>mod_wsgi 提供
<a href="http://code.google.com/p/modwsgi/wiki/ConfigurationDirectives">许多可行方法</a>
来实现WSGI应用, 但一种简单的方法是添加以下到 .htaccess：</p>
<div class="highlight"><pre><span></span>    SetHandler wsgi-script
    Options ExecCGI FollowSymLinks
</pre></div>


<p>如果在apache的 error.log 文件中出现 "ImportError: No module named web"，
在导入web之前，你可能需要在code.py中尝试设置绝对路径：</p>
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span>
<span class="n">abspath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">__file__</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">abspath</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">abspath</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">web</span>
</pre></div>


<p>同时， 你可能需要查看
<a href="http://code.google.com/p/modwsgi/wiki/ApplicationIssues">WSGI应用的常见问题</a>的
"Application Working Directory" 部分。</p>
<p>最终应该可以访问 <code>http://example.com/code.py/</code>。</p>
<p><a name="apachemodrewrite"></a>\</p>
<h4>mod_rewrite 法则，Apache</h4>
<p>如果希望 web.py 能够通过 '<a href="http://example.com/">http://example.com</a>'
访问，代替使用 '<a href="http://example.com/code.py/">http://example.com/code.py/</a>'， 添加以下法则到
<code>.htaccess</code> 文件：</p>
<div class="highlight"><pre><span></span>  RewriteEngine on
  RewriteBase /
  RewriteCond %{REQUEST_URI} !^/icons
  RewriteCond %{REQUEST_URI} !^/favicon.ico$
  RewriteCond %{REQUEST_URI} !^(/.*)+code.py/
  RewriteRule ^(.*)$ code.py/$1 [PT]
</pre></div>


<p>如果 <code>code.py</code> 在子目录 <code>myapp/</code>中， 调整 RewriteBase 为
<code>RewriteBase /myapp/</code>。 如果还有一些静态文件如CSS文件和图片文件,
复制这些并改成你需要的地址。</p>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lmattbit';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
        <p>&copy; lmatt </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "web.py在cgi下的install",
  "headline": "web.py在cgi下的install",
  "datePublished": "2010-04-19 16:58:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "lmatt wang",
    "url": "http://lmatt-bit.github.io/blog/author/lmatt-wang.html"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "http://lmatt-bit.github.io/blog/web.pyzaicgixiadeinstall.html",
  "description": "由于ixwebhosting下无法安装web.py之类的程序，只能将web.py当作工程的一部分。这需要将web.py下的web目录拷贝到工程目录中，以后只需要import web就可以使用web.py了。 web.py可以和Lighttpd,Apache搭配使用。web.py的官网推荐的是使用lighttpd（fastcgi）。这里介绍的是Apache下的CGI方式（这种方式效率不高，不过在ixwebhosting下只能使用这种方式）。 在.htaccess下添加如下代码： [codesyntax lang="apache"] Options +ExecCGI AddHandler cgi-script .py [/codesyntax] 或者在http.conf（或apache2.conf）下添加如下代码： [codesyntax lang="apache"] Alias /foo/static/ /path/to/static ScriptAlias /foo/ /path/to/code.py [/codesyntax ..."
}
</script></body>
</html>