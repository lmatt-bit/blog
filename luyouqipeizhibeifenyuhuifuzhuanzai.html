<!DOCTYPE html>
<html lang="en">
<head>
  <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,400italic' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/pygments.min.css">
  <link rel="stylesheet" type="text/css" href="http://lmatt-bit.github.io/blog/theme/stylesheet/font-awesome.min.css">





  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="" />

<meta name="author" content="lmatt wang" />
<meta name="description" content="Introduction Routers often get upgraded or swapped out for a number of reasons. This document provides the user with some basic steps to migrate the configuration from an existing router to a new router.\ Prerequisites Requirements Before you use the information in this document, make sure that you meet these ..." />
<meta name="keywords" content="">
<meta property="og:site_name" content="do not know"/>
<meta property="og:title" content="路由器配置备份与恢复（转载）"/>
<meta property="og:description" content="Introduction Routers often get upgraded or swapped out for a number of reasons. This document provides the user with some basic steps to migrate the configuration from an existing router to a new router.\ Prerequisites Requirements Before you use the information in this document, make sure that you meet these ..."/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="http://lmatt-bit.github.io/blog/luyouqipeizhibeifenyuhuifuzhuanzai.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2010-06-28 03:02:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="http://lmatt-bit.github.io/blog/author/lmatt-wang.html">
<meta property="article:section" content="misc"/>
<meta property="og:image" content="">
  <title>do not know &ndash; 路由器配置备份与恢复（转载）</title>
</head>
<body>
  <aside>
    <div>
      <a href="http://lmatt-bit.github.io/blog">
        <img src="http://lmatt-bit.github.io/blog/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href="http://lmatt-bit.github.io/blog"></a></h1>
      <p></p>
      <nav>
        <ul class="list">
          <li><a href="http://lmatt-bit.github.io/blog/pages/guanyuwo(About-Me).html#guanyuwo(About-Me)">关于我(About Me)</a></li>
        </ul>
      </nav>
      <ul class="social">
      </ul>
    </div>
  </aside>
  <main>

<article>
  <header>
    <h1 id="luyouqipeizhibeifenyuhuifuzhuanzai">路由器配置备份与恢复（转载）</h1>
    <p>Posted on Mon 28 June 2010 in <a href="http://lmatt-bit.github.io/blog/category/misc.html">misc</a></p>
  </header>
  <div>
    <h2><a name="intro">Introduction</a></h2>
<p>Routers often get upgraded or swapped out for a number of reasons. This
document provides the user with some basic steps to migrate the
configuration from an existing router to a new router.\</p>
<h2><a name="prereq">Prerequisites</a></h2>
<h3><a name="req">Requirements</a></h3>
<p>Before you use the information in this document, make sure that you meet
these requirements:</p>
<ul>
<li>Access to a Trivial File Transfer Protocol (TFTP) or File Transfer
    Protocol (FTP) server.</li>
<li>Connectivity - Routers must be able to access the FTP or TFTP
    server. Use the <strong>ping</strong> command to verify connectivity.</li>
</ul>
<h3><a name="hw">Components Used</a></h3>
<p>This document is not restricted to specific software and hardware
versions.</p>
<p>The information in this document was created from the devices in a
specific lab environment. All of the devices used in this document
started with a cleared (default) configuration. If your network is live,
make sure that you understand the potential impact of any command.\</p>
<h3><a name="conventions">Conventions</a></h3>
<p>Refer to <a href="http://www.cisco.com/en/US/tech/tk801/tk36/technologies_tech_note09186a0080121ac5.shtml">Cisco Technical Tips
Conventions</a>
for more information on document conventions.\</p>
<h2><a name="backup">Make a Backup of the Configuration</a></h2>
<p>There are several methods to choose from in order to back up and restore
a configuration:</p>
<ul>
<li><a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_tech_note09186a008020260d.shtml#tftp">Use a TFTP
    server</a></li>
<li><a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_tech_note09186a008020260d.shtml#ftp">Use an FTP
    server</a></li>
<li><a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_tech_note09186a008020260d.shtml#em-prog">Use a Terminal Emulation
    Program</a></li>
<li><a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_tech_note09186a008020260d.shtml#ab">Automatic Backup of Configuration using the Kron
    Method</a></li>
<li><a href="http://www.cisco.com/en/US/products/sw/iosswrel/ps1835/products_tech_note09186a008020260d.shtml#bcb">Backup Configuration to a TFTP
    Server</a></li>
</ul>
<h3><a name="tftp">Use a TFTP Server to Backup and Restore a Configuration</a></h3>
<p>This is a step-by-step approach to copy a configuration from a router to
a TFTP server, and back to another router. Before you proceed with this
method, make sure you have a TFTP server on the network to which you
have IP connectivity.</p>
<ol>
<li>At the <code>Router&gt;</code> prompt, issue the <strong>enable</strong> command, and provide
    the required password when prompted.
    </p>
    <p>
    The prompt changes to <code>Router#</code>, which indicates that the router is
    now in privileged mode.</li>
<li>
<p>Copy the running configuration file to the TFTP server:\</p>
<blockquote>
<div class="highlight"><pre><span></span>CE_2#copy running-config tftp:
Address or name of remote host []? 64.104.207.171
Destination filename [ce_2-confg]? backup_cfg_for_my_router
!!
1030 bytes copied in 2.489 secs (395 bytes/sec)
CE_2#
</pre></div>


</blockquote>
<p><p>
3.  Open the configuration file with a text editor. Search for and
remove any line that starts with "AAA".
</p>
<p>
<strong>Note:</strong> This step is to remove any security commands that can lock
you out of the router.
4.  Copy the configuration file from the TFTP server to a new router in
privileged (enable) mode which has a basic configuration.\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router#copy tftp: running-config
Address or name of remote host []? 64.104.207.171
Source filename []? backup_cfg_for_my_router
Destination filename [running-config]?
Accessing tftp://10.66.64.10/backup_cfg_for_my_router...
Loading backup_cfg_for_router from 64.104.207.171 (via FastEthernet0/0): !
[OK - 1030 bytes]

1030 bytes copied in 9.612 secs (107 bytes/sec)
CE_2#
</pre></div>


</blockquote>
<p>

</li>
</ol>
<h3><a name="ftp">Use an FTP Server to Backup and Restore a Configuration</a></h3>
<p>In this procedure, an FTP server can be used in place of a TFTP server.</p>
<ol>
<li>At the <code>Router&gt;</code> prompt, issue the <strong>enable</strong> command, and provide
    the required password when prompted.
    </p>
    <p>
    The prompt changes to <code>Router#</code>, which indicates that the router is
    now in privileged mode.</li>
<li>
<p>Configure the FTP username and password.\</p>
<blockquote>
<div class="highlight"><pre><span></span>CE_2#config terminal
CE_2(config)#ip ftp username cisco
CE_2(config)#ip ftp password cisco123
CE_2(config)#end
CE_2#
</pre></div>


</blockquote>
<p><p>
3.  Copy the configuration to the FTP server.\</p>
<blockquote>
<div class="highlight"><pre><span></span>CE_2#copy running-config ftp:
Address or name of remote host []? 10.66.64.10
Destination filename [ce_2-confg]? backup_cfg_for_router
Writing backup_cfg_for_router !
1030 bytes copied in 3.341 secs (308 bytes/sec)
CE_2#
</pre></div>


</blockquote>
<p><p>
4.  Open the configuration file with a text editor. Search for and
remove any line that starts with "AAA".
</p>
<p>
<strong>Note:</strong> This step is to remove any security commands that can lock
you out of the router.
5.  Copy the configuration file from the FTP server to a router in
privileged (enable) mode which has a basic configuration.\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router#copy ftp: running-config
Address or name of remote host [10.66.64.10]?
Source filename [backup_cfg_for_router]?
Destination filename [running-config]?
Accessing ftp://10.66.64.10/backup_cfg_for_router...
Loading backup_cfg_for_router !
[OK - 1030/4096 bytes]
1030 bytes copied in 13.213 secs (78 bytes/sec)
CE_2#
</pre></div>


</blockquote>
<p>

</li>
</ol>
<h3><a name="em-prog">Use a Terminal Emulation Program to Backup and Restore a Configuration</a></h3>
<p>A terminal emualation program can be used to back up and restore a
configuration. This is a description of the procedure using Microsoft
Hyperterminal Terminal Emulation software:</p>
<ol>
<li>If the configuration needs to be copied from another router, connect
    to that router through the console or Telnet.</li>
<li>At the <code>Router&gt;</code> prompt, issue the <strong>enable</strong> command, and provide
    the required password when prompted.
    </p>
    <p>
    The prompt changes to <code>Router#</code>, which indicates that the router is
    now in privileged mode.</li>
<li>Issue the <strong>terminal length 0</strong> command in order to force the router
    to return the entire response at once, rather than one screen at a
    time.
    </p>
    <p>
    This allows you to capture the configuration without extraneous
    <code>--more--</code> prompts generated when the router responds one screen at
    a time.</li>
<li>On the HyperTerminal menu, choose <strong>Transfer > Capture Text</strong>.
    </p>
    <p>
    The Capture Text window appears.</li>
<li>Name this file "config.txt."</li>
<li>Click <strong>Start</strong> in order to dismiss the Capture Text window and
    begin the capture.</li>
<li>
<p>Issue the <strong>show running-config</strong> command, and allow time for the
    router to complete its response. You will see:\</p>
<blockquote>
<div class="highlight"><pre><span></span>Building configuration...
</pre></div>


</blockquote>
<p><p>
followed by the configuration.</p>
</li>
<li>
<p>On the HyperTerminal menu, choose <strong>Transfer > Capture Text >
    Stop</strong> in order to end the screen capture.</p>
</li>
<li>Open the config.txt file you created in any text editor, such as
    Notepad or Wordpad.</li>
<li>Search for and remove any line that starts with "AAA".
    </p>
    <p>
    <strong>Note:</strong> This step is to remove any security commands that could
    lock you out of the router.</li>
<li>Save the file.</li>
<li>Connect to the router that needs the configuration.</li>
<li>Open the config.txt file.</li>
<li>Highlight the entire contents of the config.txt file.
    </p>
    <p>
    You can do this by dragging the cursor from before the first
    character to after the last character in the file while holding down
    the left mouse button. Alternatively, if you use Notepad, you can
    choose <strong>Edit > Select All</strong> from the menu.</li>
<li>Copy the selected text to the Windows clipboard.
    </p>
    <p>
    You can either choose <strong>Edit > Copy</strong> from the text editor menu, or
    hold down the <strong>CTRL</strong> key and simultaneously press the <strong>C</strong> key in
    order to perform the copy.</li>
<li>Switch to the HyperTerminal window, and issue the <strong>configure
    terminal</strong> command at the <code>Router#</code> prompt. Then press <strong>Enter</strong>.</li>
<li>Paste the configuration file into the router by selecting <strong>Edit >
    Paste to Host</strong> on the HyperTerminal menu.</li>
<li>After the configuration has finished pasting and the router brings
    you back to the configuration prompt, issue the <strong>copy
    running-config startup-config</strong> command in order to write the
    configuration into memory.</li>
<li>Issue the <strong>exit</strong> command in order to return to the <code>Router#</code>
    prompt.</li>
</ol>
<h3><a name="ab">Automatic Backup of Configuration using the Kron Method</a></h3>
<p>In order to get a router to copy the running-config to startup-config,
for example every Sunday at 23:00, complete these steps:</p>
<ol>
<li>
<p><strong>Create a kron policy list</strong>—This is the script that lists what
    commands the router should run at the scheduled time.\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router(config)#kron policy-list SaveConfig

        Router(config-kron-policy)#cli write
        Router(config-kron-policy)#exit
</pre></div>


</blockquote>
<ul>
<li><strong>cli</strong>—Specifies EXEC CLI commands within a Command Scheduler
    policy list.</li>
<li><strong>Policy-list</strong>—Specifies the policy list associated with a
    Command Scheduler occurrence.</li>
</ul>
<p><p>
<strong>Note:</strong> The reason why <strong>write</strong> was used rather than <strong>copy
running-config startup-config</strong> is because kron does not support
interactive prompts and the <strong>copy running-config startup-config</strong>
command requires interaction. It is important to remember this when
you create commands. Also, note that kron does not support
configuration commands.</p>
</li>
<li>
<p><strong>Create a kron occurrence</strong>—This informs the router when and how
    often the policy should run.\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router(config)#kron occurrence SaveConfigSchedule
 at 23:00 Sun recurring
        Router(config-kron-occurrence)#policy-list SaveConfig
</pre></div>


</blockquote>
<ul>
<li><strong>SaveConfigSchedule</strong>—This is the name of occurrence. Length of
    occurrence-name is from 1 to 31 characters. If the
    occurrence-name is new, an occurrence structure will be created.
    If the occurrence-name is not new, the existing occurrence will
    be edited.</li>
<li><strong>at</strong>—Identifies that the occurrence is to run at a specified
    calendar date and time.</li>
<li><strong>recurring</strong>—Identifies that the occurrence is to run on a
    recurring basis.</li>
</ul>
<p><p>
3.  Verify the kron configuration by using the <strong>show</strong> command.\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router#sh kron schedule
         Kron Occurrence Schedule
         SaveConfigSchedule inactive, will run again in 1 days 12:37:47 at 23:00 on Sun
</pre></div>


</blockquote>
<ul>
<li><strong>inactive</strong>—Means that kron is not running the command(s) at
    present.</li>
<li><strong>Active</strong>—Means that kron is running the current command(s).</li>
</ul>
<blockquote>
<div class="highlight"><pre><span></span>Router#show running-configuration
          kron occurrence SaveConfigSchedule at 23:00 Sun recurring
            policy-list SaveConfig
            kron policy-list SaveConfig
            cli write
</pre></div>


</blockquote>
<p>

</li>
</ol>
<h3><a name="bcb">Backup Configuration to a TFTP Server</a></h3>
<p>This example is to save the running config to a TFTP server (10.1.1.1)
every Sunday at 23:00:\</p>
<blockquote>
<div class="highlight"><pre><span></span>Router(config)#kron policy-list Backup

         Router(config-kron-policy)#cli show run | redirect
   tftp://10.1.1.1/test.cfg
         Router(config-kron-policy)#exit
         !
         Router(config)#kron occurrence Backup at 23:00 Sun recurring
         Router(config-kron-occurrence)#policy-list Backup
</pre></div>


</blockquote>
<h2><a name="verify">Verify</a></h2>
<p>Use the <strong>show running-config</strong> command to confirm that the
configuration file has been copied to the destination router.\</p>
<h2><a name="NetPro">Cisco Support Community - Featured Conversations</a></h2>
<!--googleoff: all-->

<p><a href="https://supportforums.cisco.com/index.jspa">Cisco Support
Community</a> is a forum for
you to ask and answer questions, share suggestions, and collaborate with
your peers. Below are just some of the most recent and relevant
conversations happening right now.</p>
  </div>
  <div class="tag-cloud">
    <p>
    </p>
  </div>
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'lmattbit';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</article>

    <footer>
        <p>&copy; lmatt </p>
<p>Built using <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a></p>    </footer>
  </main>





<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "路由器配置备份与恢复（转载）",
  "headline": "路由器配置备份与恢复（转载）",
  "datePublished": "2010-06-28 03:02:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "lmatt wang",
    "url": "http://lmatt-bit.github.io/blog/author/lmatt-wang.html"
  },
  "image": "{{ SITEURL }}/{{ THEME_STATIC_DIR }}/img/profile.png",
  "url": "http://lmatt-bit.github.io/blog/luyouqipeizhibeifenyuhuifuzhuanzai.html",
  "description": "Introduction Routers often get upgraded or swapped out for a number of reasons. This document provides the user with some basic steps to migrate the configuration from an existing router to a new router.\ Prerequisites Requirements Before you use the information in this document, make sure that you meet these ..."
}
</script></body>
</html>